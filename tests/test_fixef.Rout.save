
R version 3.6.2 (2019-12-12) -- "Dark and Stormy Night"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### Test of fixef
> ###
> ### (1): general tests
> ### (2): consistency with summary.plm
> ###
> ### see also:
> ###    * test file test_within_intercept.R for consistency checks
> ###      between functions fixef and within_intercept
> ###    * test file test_fixef_comp_lm_plm.R for a comparison of the fixed effects to LSDV models via lm()
> 
> ############# (1): general run tests #############
> library(plm)
> data("Grunfeld", package = "plm")
> gi <- plm(inv ~ value + capital, data = Grunfeld, model = "within")
> gt <- plm(inv ~ value + capital, data = Grunfeld, model = "within", effect = "time")
> gd <- plm(inv ~ value + capital, data = Grunfeld, model = "within", effect = "twoways")
> 
> 
> f_level             <- fixef(gi, type = "level")
> f_level_robust_mat  <- fixef(gi, type = "level", vcov = vcovHC(gi)) # vcov is matrix
> f_level_robust_func <- fixef(gi, type = "level", vcov = vcovHC)     # vcov is function
> 
> print(attr(f_level,             "se"))
       1        2        3        4        5        6        7        8 
49.70796 24.93832 24.43162 14.07775 14.16543 12.66874 12.84297 13.99315 
       9       10 
12.89189 11.82689 
> print(attr(f_level_robust_func, "se"))
       1        2        3        4        5        6        7        8 
85.97346 40.49648 44.27241 18.56579 28.84028 15.45980 20.71591 17.26171 
       9       10 
21.56692 11.86157 
> 
> print(summary(f_level),             digits = 8)
       Estimate   Std. Error  t-value   Pr(>|t|)    
1   -70.2967175   49.7079588 -1.41419   0.158959    
2   101.9058137   24.9383232  4.08631 6.4852e-05 ***
3  -235.5718410   24.4316165 -9.64209 < 2.22e-16 ***
4   -27.8092946   14.0777538 -1.97541   0.049685 *  
5  -114.6168128   14.1654333 -8.09130 7.1411e-14 ***
6   -23.1612951   12.6687393 -1.82822   0.069101 .  
7   -66.5534735   12.8429734 -5.18209 5.6290e-07 ***
8   -57.5456573   13.9931464 -4.11242 5.8477e-05 ***
9   -87.2222724   12.8918932 -6.76567 1.6345e-10 ***
10   -6.5678435   11.8268910 -0.55533   0.579328    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> print(summary(f_level_robust_func), digits = 8)
       Estimate   Std. Error  t-value   Pr(>|t|)    
1   -70.2967175   85.9734634 -0.81766 0.41458870    
2   101.9058137   40.4964809  2.51641 0.01269214 *  
3  -235.5718410   44.2724091 -5.32096 2.9169e-07 ***
4   -27.8092946   18.5657912 -1.49788 0.13584202    
5  -114.6168128   28.8402827 -3.97419 0.00010058 ***
6   -23.1612951   15.4597951 -1.49816 0.13576805    
7   -66.5534735   20.7159098 -3.21267 0.00154736 ** 
8   -57.5456573   17.2617119 -3.33372 0.00103213 ** 
9   -87.2222724   21.5669197 -4.04426 7.6538e-05 ***
10   -6.5678435   11.8615708 -0.55371 0.58043682    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> f_level_t             <- fixef(gt, type = "level")
> f_level_t_robust_func <- fixef(gt, type = "level", vcov = vcovHC)     # vcov is function
> 
> print(attr(f_level_t,             "se"))
    1935     1936     1937     1938     1939     1940     1941     1942 
31.25408 31.57989 31.87894 31.39361 31.58505 31.63576 31.62813 31.58354 
    1943     1944     1945     1946     1947     1948     1949     1950 
31.67263 31.68469 31.77937 31.87299 32.14450 32.45284 32.75761 32.93717 
    1951     1952     1953     1954 
33.13580 33.73808 34.64354 35.72691 
> print(attr(f_level_t_robust_func, "se"))
    1935     1936     1937     1938     1939     1940     1941     1942 
32.34680 34.18345 35.75038 33.20545 34.20602 34.46783 34.51459 34.60309 
    1943     1944     1945     1946     1947     1948     1949     1950 
35.04938 35.07138 35.52617 36.06382 38.57547 40.71600 42.66511 43.70350 
    1951     1952     1953     1954 
44.51379 48.04058 52.69984 58.48207 
> 
> print(summary(f_level_t),             digits = 8)
       Estimate Std. Error  t-value Pr(>|t|)  
1935 -23.574968  31.254082 -0.75430 0.451666  
1936 -40.787307  31.579889 -1.29156 0.198184  
1937 -58.066240  31.878940 -1.82146 0.070216 .
1938 -52.017730  31.393606 -1.65695 0.099291 .
1939 -79.818004  31.585049 -2.52708 0.012372 *
1940 -54.079700  31.635759 -1.70945 0.089111 .
1941 -26.202078  31.628133 -0.82844 0.408530  
1942 -24.997122  31.583540 -0.79146 0.429729  
1943 -45.376238  31.672627 -1.43266 0.153708  
1944 -45.692318  31.684692 -1.44209 0.151033  
1945 -57.171437  31.779365 -1.79901 0.073711 .
1946 -30.603029  31.872994 -0.96016 0.338279  
1947 -28.821095  32.144500 -0.89661 0.371138  
1948 -27.494440  32.452843 -0.84721 0.398015  
1949 -52.368285  32.757614 -1.59866 0.111670  
1950 -51.929057  32.937171 -1.57661 0.116661  
1951 -35.246908  33.135802 -1.06371 0.288901  
1952 -29.188192  33.738078 -0.86514 0.388126  
1953 -21.125971  34.643537 -0.60981 0.542765  
1954 -35.889838  35.726906 -1.00456 0.316472  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> print(summary(f_level_t_robust_func), digits = 8)
       Estimate Std. Error  t-value Pr(>|t|)  
1935 -23.574968  32.346803 -0.72882 0.467070  
1936 -40.787307  34.183451 -1.19319 0.234383  
1937 -58.066240  35.750385 -1.62421 0.106100  
1938 -52.017730  33.205451 -1.56654 0.118998  
1939 -79.818004  34.206017 -2.33345 0.020742 *
1940 -54.079700  34.467834 -1.56899 0.118426  
1941 -26.202078  34.514590 -0.75916 0.448761  
1942 -24.997122  34.603094 -0.72240 0.470999  
1943 -45.376238  35.049382 -1.29464 0.197122  
1944 -45.692318  35.071383 -1.30284 0.194313  
1945 -57.171437  35.526170 -1.60928 0.109328  
1946 -30.603029  36.063821 -0.84858 0.397255  
1947 -28.821095  38.575472 -0.74714 0.455968  
1948 -27.494440  40.716004 -0.67527 0.500378  
1949 -52.368285  42.665111 -1.22743 0.221283  
1950 -51.929057  43.703498 -1.18821 0.236333  
1951 -35.246908  44.513794 -0.79182 0.429520  
1952 -29.188192  48.040583 -0.60757 0.544245  
1953 -21.125971  52.699844 -0.40087 0.688994  
1954 -35.889838  58.482071 -0.61369 0.540204  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> f_level_d             <- fixef(gd, type = "level")
> f_level_d_robust_func <- fixef(gd, type = "level", vcov = vcovHC)     # vcov is function
> 
> print(attr(f_level_d,             "se"))
       1        2        3        4        5        6        7        8 
58.29153 28.45146 28.09987 14.73558 15.68344 12.83972 13.44400 14.57249 
       9       10 
13.51968 11.60453 
> print(attr(f_level_d_robust_func, "se"))
       1        2        3        4        5        6        7        8 
63.65105 30.73136 34.10876 15.72257 25.10972 13.84943 18.48569 14.75735 
       9       10 
18.87670 11.59812 
> 
> print(summary(f_level_d),             digits = 8)
       Estimate   Std. Error  t-value   Pr(>|t|)    
1  -134.2277085   58.2915317 -2.30270  0.0225150 *  
2    72.8265314   28.4514602  2.55968  0.0113531 *  
3  -269.4585082   28.0998668 -9.58932 < 2.22e-16 ***
4   -38.8738664   14.7355799 -2.63810  0.0091159 ** 
5  -139.6663036   15.6834432 -8.90533 8.1302e-16 ***
6   -31.3390660   12.8397218 -2.44079  0.0156871 *  
7   -82.7610986   13.4440048 -6.15599 5.2554e-09 ***
8   -66.7371940   14.5724872 -4.57967 9.0002e-06 ***
9  -104.0101528   13.5196814 -7.69324 1.1335e-12 ***
10   -7.3905857   11.6045253 -0.63687  0.5250706    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> print(summary(f_level_d_robust_func), digits = 8)
       Estimate   Std. Error  t-value   Pr(>|t|)    
1  -134.2277085   63.6510469 -2.10881   0.036435 *  
2    72.8265314   30.7313627  2.36978   0.018927 *  
3  -269.4585082   34.1087552 -7.89998 3.4000e-13 ***
4   -38.8738664   15.7225698 -2.47249   0.014407 *  
5  -139.6663036   25.1097193 -5.56224 1.0240e-07 ***
6   -31.3390660   13.8494323 -2.26284   0.024918 *  
7   -82.7610986   18.4856909 -4.47704 1.3876e-05 ***
8   -66.7371940   14.7573476 -4.52230 1.1474e-05 ***
9  -104.0101528   18.8767034 -5.50997 1.3180e-07 ***
10   -7.3905857   11.5981208 -0.63722   0.524842    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> # just run tests for type = "dmean" and type = "dfirst"
> fixef(gi, type = "dmean")
        1         2         3         4         5         6         7         8 
 -11.5528  160.6498 -176.8279   30.9346  -55.8729   35.5826   -7.8095    1.1983 
        9        10 
 -28.4783   52.1761 
> fixef(gt, type = "dmean")
     1935      1936      1937      1938      1939      1940      1941      1942 
 17.44753   0.23519 -17.04374 -10.99523 -38.79551 -13.05720  14.82042  16.02538 
     1943      1944      1945      1946      1947      1948      1949      1950 
 -4.35374  -4.66982 -16.14894  10.41947  12.20140  13.52806 -11.34579 -10.90656 
     1951      1952      1953      1954 
  5.77559  11.83431  19.89653   5.13266 
> fixef(gd, effect = "individual", type = "dmean")
        1         2         3         4         5         6         7         8 
 -54.0639  152.9903 -189.2947   41.2899  -59.5025   48.8247   -2.5973   13.4266 
        9        10 
 -23.8464   72.7732 
> fixef(gd, effect = "time",       type = "dmean")
    1935     1936     1937     1938     1939     1940     1941     1942 
 47.3275  28.1301   6.6375   8.1011 -22.1428   3.0924  28.5230  26.1877 
    1943     1944     1945     1946     1947     1948     1949     1950 
  4.3499   4.2287  -8.3556  16.1582   7.9352   3.6110 -26.1676 -28.5686 
    1951     1952     1953     1954 
-15.1534 -17.3049 -20.3905 -46.1987 
> 
> fixef(gi, type = "dfirst")
        2         3         4         5         6         7         8         9 
 172.2025 -165.2751   42.4874  -44.3201   47.1354    3.7432   12.7511  -16.9256 
       10 
  63.7289 
> fixef(gt, type = "dfirst")
    1936     1937     1938     1939     1940     1941     1942     1943 
-17.2123 -34.4913 -28.4428 -56.2430 -30.5047  -2.6271  -1.4222 -21.8013 
    1944     1945     1946     1947     1948     1949     1950     1951 
-22.1173 -33.5965  -7.0281  -5.2461  -3.9195 -28.7933 -28.3541 -11.6719 
    1952     1953     1954 
 -5.6132   2.4490 -12.3149 
> fixef(gd, effect = "individual", type = "dfirst")
        2         3         4         5         6         7         8         9 
 207.0542 -135.2308   95.3538   -5.4386  102.8886   51.4666   67.4905   30.2176 
       10 
 126.8371 
> fixef(gd, effect = "time",       type = "dfirst")
   1936    1937    1938    1939    1940    1941    1942    1943    1944    1945 
-19.197 -40.690 -39.226 -69.470 -44.235 -18.804 -21.140 -42.978 -43.099 -55.683 
   1946    1947    1948    1949    1950    1951    1952    1953    1954 
-31.169 -39.392 -43.717 -73.495 -75.896 -62.481 -64.632 -67.718 -93.526 
> 
> 
> ############# (2): consistency with summary.plm #############
> # compare summary.plm to summary.fixef( , type = "dfirst")
> mod_pool <- plm(inv ~ value + capital + factor(firm), data = Grunfeld, model = "pooling")
> sum_mod_pool <- summary(mod_pool)
> f_dfirst <- fixef(gi, type = "dfirst")
> sum_f_dfirst <- summary(f_dfirst)
> 
> if (!isTRUE(all.equal(sum_mod_pool[["coefficients"]][-c(1:3) , "Estimate"], sum_f_dfirst[ , "Estimate"], check.attributes = FALSE)))
+   stop("estimates diverge: summary.plm vs. summary.fixef(..., type = \"dfirst\")")
> 
> if (!isTRUE(all.equal(sum_mod_pool[["coefficients"]][-c(1:3) , "Std. Error"], sum_f_dfirst[ , "Std. Error"], check.attributes = FALSE)))
+   stop("standard errors diverge: summary.plm vs. summary.fixef(..., type = \"dfirst\")")
> 
> if (!isTRUE(all.equal(sum_mod_pool[["coefficients"]][-c(1:3) , "t-value"], sum_f_dfirst[ , "t-value"], check.attributes = FALSE)))
+   stop("t-values diverge: summary.plm vs. summary.fixef(..., type = \"dfirst\")")
> 
> if (!isTRUE(all.equal(sum_mod_pool[["coefficients"]][-c(1:3) , "Pr(>|t|)"], sum_f_dfirst[ , "Pr(>|t|)"], check.attributes = FALSE)))
+   stop("p-values diverge: summary.plm vs. summary.fixef(..., type = \"dfirst\")")
> 
> 
> ###### compare to package lfe:
> ## Standard errors are bootstrapped in lfe
> ##  -> different results compared to plm
> ##  -> different results for every new call
> #
> # library(lfe)
> # mod_felm <- felm(inv ~ value + capital | firm, data = Grunfeld)
> # summary(mod_felm)
> #
> # fe_lfe <- getfe(mod_felm, se = TRUE, bN = 50)
> # print(fe_lfe)
> # sum_f_level <- summary(f_level)
> # print(sum_f_level)
> 
> proc.time()
   user  system elapsed 
  0.706   0.024   0.719 
